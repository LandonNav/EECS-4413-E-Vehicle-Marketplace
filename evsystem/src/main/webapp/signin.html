<!DOCTYPE html>
<!--Author: Rucheng Yao, Description: Sign-in page for EV System-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
  <header>
    <h1>Sign In</h1> <!-- Page heading -->
    <nav>
      <a href="catalog.html">Catalog</a>
      <a href="register.html">Register</a>
    </nav>
    <div id="user-controls" style="margin:10px 0;">
      <button id="signoutBtn" style="display:none;">Sign Out</button>
      <span id="userStatus"></span>
    </div>
  </header>
  <div class="container"> <!-- Main content -->
    <form id="signinForm"> <!-- Login form -->
      <label for="username">Username or Email:</label><br>
      <input type="text" id="username" name="username" required><br><br> <!-- Username input -->
      
      <label for="password">Password:</label><br>
      <input type="password" id="password" name="password" required><br><br> <!-- Password input -->
      
      <button type="submit">Sign In</button> <!-- Submit button -->
    </form>
    <div id="error" style="color: red; margin-top:10px;"></div> <!-- Error message -->
  </div>
  <footer>
    <p>Â© 2025 Electric Vehicle System</p> <!-- Footer -->
  </footer>
  <script>
    $(document).ready(function(){
      $.ajax({
      url: "/api/auth/status",
      type: 'GET',
      success: function(data) {
        if (data.signedIn) {
          $("#signoutBtn").show();
          $("#userStatus").text("Logged in");
          if (data.userId) {
            localStorage.setItem('userId', data.userId);
          }
        } else {
          $("#signoutBtn").hide();
          $("#userStatus").text("Not signed in");
        }
      }
    });

    $("#signoutBtn").click(function() {
      $.ajax({
        url: "/api/auth/signout",
        type: 'POST',
        success: function() {
          window.location.href = "signin.html";
        }
      });
    });
      // Form submit
      $("#signinForm").on("submit", function(e){
        e.preventDefault(); // Prevent reload
        var username = $("#username").val(); // Get username
        var password = $("#password").val(); // Get password
        // Send AJAX request
        $.ajax({
          url: "/api/auth/signin",
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({username: username, password: password}),
          success: function(result, status, xhr){
            console.log("SIGNIN success:", result, status, xhr);
            window.location.href = "catalog.html";
          },
          error: function(xhr, status, error){
          console.log("SIGNIN error:", xhr, status, error);
          $("#error").text("Invalid username or password.");
          }
      });
      });
    });
  </script>
</body>
</html>

